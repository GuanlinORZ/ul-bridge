<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>返回 App</title>
  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto; padding: 24px; }
    button { padding: 12px 16px; border-radius: 12px; border: 1px solid #ddd; }
  </style>
</head>
<body>
  <h2>正在为你返回 App…</h2>
  <p>如果没有自动跳转，请点击下方按钮。</p>
  <button id="open">立刻返回 App</button>
  <div id="status" style="margin-top:12px;color:#666"></div>

  <script>
    // 从当前 URL 拿到参数
    const params = new URLSearchParams(location.search);

    // 这里替换为你实际的 Universal Link 域名 + 回跳路径
    const ul = `https://ace.tb.cn/t?smburl=tbopen%3A%2F%2Fm.taobao.com%2Ftbopen%2Findex.html%3Fh5Url%3Dhttps%253A%252F%252Fpages.tmall.com%252Fwow%252Fz%252Fhdwk%252Ffarm-tubes%252Fbbf-9f02hw5fej%253FforbidRefineType%253DgoOut%2526shareKey%253DRw8Gb5AZ0Cv7nk7KAdt1zOeMR%2526disableNav%253DYES%2526sourceType%253Dother%2526suid%253D007c076e-57e8-4e7d-9a89-3ba9c2cfb168%2526ut_sk%253D1.utdid_21646297_1753713476768.wxfriend-taopassword.farmkankanjia%2526un%253D965b6eb353022dcc0fa7d045a29c7155%2526share_crt_v%253D1%2526un_site%253D0%2526spm%253Da2159r.13376460.0.0%2526sp_tk%253DUGg1MDRmVDNnZUg%25253D%2526cpp%253D1%2526shareurl%253Dtrue%2526short_name%253Dh.hmwXAHj%26action%3Dali.open.nav%26module%3Dh5%26bootImage%3D0%26slk_gid%3Dgid_er_sidebar_0%26afcPromotionOpen%3Dfalse%26bc_fl_src%3Dh5_huanduan%26source%3Dslk_dp?${params.toString()}`;

    const status = document.getElementById('status');
    const go = () => { location.href = ul; };

    // 点击按钮返回 App（兜底）
    document.getElementById('open').addEventListener('click', () => {
      status.textContent = '正在打开 App…';
      go();
    });

    // 自动跳转（多数场景可行）
    setTimeout(() => {
      status.textContent = '尝试自动打开 App…';
      go();
    }, 300);

    // 成功/失败探测
    let success = false;
    document.addEventListener('visibilitychange', () => {
      if (document.visibilityState === 'hidden') success = true;
    });
    setTimeout(() => {
      if (!success) {
        status.textContent = '未能自动打开 App，请点击上方按钮返回';
      }
    }, 2000);
  </script>
</body>
</html>
